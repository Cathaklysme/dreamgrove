actions=call_action_list,name=dreamcatcher,if=runeforge.timeworn_dreamcatcher.equipped
actions+=/call_action_list,name=aoe,if=spell_targets.starfall>1
actions+=/call_action_list,name=st


actions.aoe=moonfire,target_if=refreshable&time_to_die>18,if=(cooldown.ca_inc.ready|spell_targets.starfall<3|(eclipse.lunar_next|eclipse.any_next|eclipse.in_solar)&(spell_targets.starfire<5*(1+talent.twin_moons.enabled)))&!buff.kindred_empowerment_energize.up&ap_check
actions.aoe+=/sunfire,target_if=refreshable&time_to_die>18,if=(buff.ca_inc.remains>10|!buff.ca_inc.up)&ap_check
actions.aoe+=/stellar_flare,target_if=refreshable&time_to_die>15,if=spell_targets.starfire<4&ap_check&(buff.ca_inc.remains>10|!buff.ca_inc.up)
actions.aoe+=/force_of_nature
actions.aoe+=/ravenous_frenzy
actions.aoe+=/celestial_alignment,if=ap_check&!buff.ca_inc.up&(floor((fight_remains-20)%cooldown)>floor((fight_remains-20-cooldown.convoke_the_spirits.remains)%cooldown)|cooldown.convoke_the_spirits.up|!covenant.night_fae)
actions.aoe+=/incarnation,if=ap_check&!buff.ca_inc.up&(floor((fight_remains-20)%cooldown)>floor((fight_remains-20-cooldown.convoke_the_spirits.remains)%cooldown)|cooldown.convoke_the_spirits.up|!covenant.night_fae)
actions.aoe+=/kindred_spirits,if=floor((fight_remains-10)%cooldown)>floor((fight_remains-10-cooldown.ca_inc.remains)%cooldown)&eclipse.in_lunar|eclipse.lunar_next&buff.starfall.up|buff.ca_inc.up|buff.primordial_arcanic_pulsar.value>=370&astral_power>50
actions.aoe+=/variable,name=convoke_condition,value=buff.primordial_arcanic_pulsar.value<350&(floor((fight_remains-7)%120)>floor((fight_remains-7-cooldown.ca_inc.remains)%120)&(!buff.ca_inc.up!|buff.ca_inc.remains>6)|(spell_targets.starfire<3&(buff.eclipse_lunar.remains>6|buff.eclipse_solar.remains>6)|buff.eclipse_lunar.remains>6&spell_targets.starfire>2)|buff.ca_inc.remains>7)
actions.aoe+=/convoke_the_spirits,if=variable.convoke_condition&astral_power<50
actions.aoe+=/fury_of_elune,if=eclipse.state=3&ap_check&buff.primordial_arcanic_pulsar.value<350&(dot.adaptive_swarm_damage.ticking|!covenant.necrolord|spell_targets>2)
actions.aoe+=/adaptive_swarm,if=spell_targets.starfall<9
actions.aoe+=/starfall,if=buff.oneths_perception.up&(!buff.starfall.up|astral_power>90)
actions.aoe+=/starsurge,if=covenant.night_fae&variable.convoke_condition&astral_power>30&cooldown.convoke_the_spirits.up&buff.starfall.up
actions.aoe+=/starfall,if=covenant.night_fae&variable.convoke_condition&astral_power>30&cooldown.convoke_the_spirits.up&!buff.starfall.up
actions.aoe+=/variable,name=starfall_wont_fall_off,value=astral_power>80-(buff.starfall.remains*4%spell_haste)-(dot.fury_of_elune.remains*5)&buff.starfall.up
actions.aoe+=/starfall,if=buff.starfall.remains<gcd.max%2|buff.starfall.remains<gcd.max&spell_targets>2
actions.aoe+=/starsurge,if=buff.oneths_clear_vision.up|!starfire.ap_check|(buff.ca_inc.remains<5&buff.ca_inc.up|(buff.ravenous_frenzy.remains<gcd.max*ceil(astral_power%30)&buff.ravenous_frenzy.up))&variable.starfall_wont_fall_off&spell_targets.starfall<5
actions.aoe+=/new_moon,if=(buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3)&ap_check
actions.aoe+=/half_moon,if=(buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3)&ap_check
actions.aoe+=/full_moon,if=(buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3)&ap_check
actions.aoe+=/warrior_of_elune,if=buff.eclipse_lunar.up
actions.aoe+=/wrath,if=eclipse.in_solar&spell_targets<=3|buff.ca_inc.remains<action.starfire.execute_time&buff.ca_inc.up
actions.aoe+=/starfire,if=buff.eclipse_lunar.up|eclipse.solar_next|buff.eclipse_solar.up&spell_targets>3
actions.aoe+=/wrath

actions.st=moonfire,target_if=refreshable&time_to_die>18,if=(cooldown.ca_inc.ready|eclipse.lunar_next|eclipse.any_next|talent.twin_moons.enabled)&!buff.kindred_empowerment_energize.up&ap_check
actions.st+=/sunfire,target_if=refreshable&time_to_die>18,if=(buff.ca_inc.remains>10|!buff.ca_inc.up)&!buff.kindred_empowerment_energize.up
actions.st+=/stellar_flare,target_if=refreshable&time_to_die>15,if=(buff.ca_inc.remains>10|!buff.ca_inc.up)&ap_check&!buff.kindred_empowerment_energize.up
actions.st+=/force_of_nature
actions.st+=/ravenous_frenzy
actions.st+=/kindred_spirits,if=floor((fight_remains-10)%cooldown)>floor((fight_remains-10-cooldown.ca_inc.remains)%cooldown)&(eclipse.in_solar|eclipse.solar_next|cooldown.ca_inc.ready)|buff.primordial_arcanic_pulsar.value>=370&astral_power>50
actions.st+=/celestial_alignment,if=ap_check&!buff.ca_inc.up&(floor((fight_remains-20)%cooldown)>floor((fight_remains-20-cooldown.convoke_the_spirits.remains)%cooldown)|cooldown.convoke_the_spirits.up|!covenant.night_fae)
actions.st+=/incarnation,if=ap_check&!buff.ca_inc.up&(floor((fight_remains-30)%cooldown)>floor((fight_remains-30-cooldown.convoke_the_spirits.remains)%cooldown)|cooldown.convoke_the_spirits.up|!covenant.night_fae)
actions.st+=/variable,name=convoke_condition,value=buff.primordial_arcanic_pulsar.value<340&(floor((fight_remains-7)%120)>floor((fight_remains-7-cooldown.ca_inc.remains)%120)|eclipse.state=3|buff.ca_inc.remains>7)
actions.st+=/convoke_the_spirits,if=variable.convoke_condition&astral_power<30
actions.st+=/fury_of_elune,if=eclipse.state=3&ap_check&buff.primordial_arcanic_pulsar.value<340&(dot.adaptive_swarm_damage.ticking|!covenant.necrolord)
actions.st+=/adaptive_swarm,if=
actions.st+=/starfall,if=buff.oneths_perception.up&!buff.starfall.up
actions.st+=/starsurge,if=covenant.night_fae&variable.convoke_condition&astral_power>30&cooldown.convoke_the_spirits.up
actions.st+=/starfall,if=talent.stellar_drift.enabled&!buff.starfall.up&(buff.eclipse_lunar.remains>6&buff.primordial_arcanic_pulsar.value<350|buff.primordial_arcanic_pulsar.value>=350&astral_power>90|dot.adaptive_swarm_damage.remains>8|action.adaptive_swarm_damage.in_flight)
# dump
actions.st+=/starsurge,if=buff.oneths_clear_vision.up|(buff.ca_inc.remains<5&buff.ca_inc.up|astral_power>90)|(buff.ravenous_frenzy.remains<gcd.max*ceil(astral_power%30)&buff.ravenous_frenzy.up)
# starlord
actions.st+=/starsurge,if=talent.starlord.enabled&(buff.starlord.up|astral_power>50)&buff.starlord.stack<3&(eclipse.in_solar|eclipse.in_both)&buff.primordial_arcanic_pulsar.value<370
actions.st+=/starsurge,if=(buff.primordial_arcanic_pulsar.value<370|buff.primordial_arcanic_pulsar.value<350&talent.stellar_drift.enabled)&eclipse.in_solar&!buff.oneths_perception.up&!talent.starlord.enabled
actions.st+=/new_moon,if=(buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3)&ap_check
actions.st+=/half_moon,if=(buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3)&ap_check
actions.st+=/full_moon,if=(buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3)&ap_check
actions.st+=/starfire,if=spell_haste<0.4&buff.eclipse_lunar.up
actions.st+=/warrior_of_elune
actions.st+=/starfire,if=eclipse.in_lunar|eclipse.solar_next|eclipse.any_next|buff.warrior_of_elune.up&buff.eclipse_lunar.up|(buff.ca_inc.remains<action.wrath.execute_time&buff.ca_inc.up)
actions.st+=/wrath,if=buff.eclipse_solar.up&(buff.ca_inc.remains>execute_time|!buff.ca_inc.up)
actions.st+=/wrath

actions.dreamcatcher=variable,name=save_to_use_spell,value=(buff.timeworn_dreamcatcher.remains>gcd.max&spell_targets.starfire=1&!eclipse.in_lunar&!eclipse.solar_next&!eclipse.any_next|buff.timeworn_dreamcatcher.remains>2.25*spell_haste&(spell_targets.starfire>1|eclipse.in_lunar|eclipse.solar_next|eclipse.any_next))|!buff.timeworn_dreamcatcher.up
actions.dreamcatcher+=/variable,name=is_aoe,value=spell_targets.starfall>1
#actions.dreamcatcher+=/variable,name=estimated_asp_gen,value=((eclipse.in_lunar*8/2.25/0.85*spell_haste)+(eclipse.in_solar*6/1.5/0.85*spell_haste)+(eclipse.in_both*6/1.5/0.85*spell_haste))*0.7
actions.dreamcatcher+=/variable,name=starfall_wont_fall_off,value=astral_power>80-(buff.starfall.remains*4%spell_haste)-(buff.timeworn_dreamcatcher.stack*12)-(dot.fury_of_elune.remains*5)&buff.starfall.up
actions.dreamcatcher+=/starfall,if=spell_targets.starfall>1&buff.starfall.remains<gcd.max%2
actions.dreamcatcher+=/starsurge,if=(!variable.save_to_use_spell|!variable.is_aoe&((buff.eclipse_solar.remains<gcd.max&buff.eclipse_solar.up)|(buff.ravenous_frenzy.remains<gcd.max*ceil(astral_power%30)&buff.ravenous_frenzy.up)))&(spell_targets.starfall=1&(buff.eclipse_solar.up|eclipse.solar_next|eclipse.any_next)|variable.starfall_wont_fall_off)|astral_power>90
actions.dreamcatcher+=/moonfire,target_if=refreshable,if=!buff.kindred_empowerment_energize.up&(spell_targets.starfire<6|(talent.twin_moons.enabled&spell_targets.starfire<12))
actions.dreamcatcher+=/sunfire,target_if=refreshable,if=!buff.kindred_empowerment_energize.up
actions.dreamcatcher+=/stellar_flare,target_if=refreshable&spell_targets.starfall<3&ap_check,if=(buff.ca_inc.remains>10|!buff.ca_inc.up)&!buff.kindred_empowerment_energize.up
actions.dreamcatcher+=/ravenous_frenzy
actions.dreamcatcher+=/celestial_alignment,if=ap_check&!buff.ca_inc.up&(buff.timeworn_dreamcatcher.remains>gcd.max|!buff.timeworn_dreamcatcher.up)&(floor((fight_remains-20)%cooldown)>floor((fight_remains-20-cooldown.convoke_the_spirits.remains)%cooldown)|cooldown.convoke_the_spirits.up|!covenant.night_fae)
actions.dreamcatcher+=/incarnation,if=ap_check&!buff.ca_inc.up&(buff.timeworn_dreamcatcher.remains>gcd.max|!buff.timeworn_dreamcatcher.up)&(floor((fight_remains-20)%cooldown)>floor((fight_remains-20-cooldown.convoke_the_spirits.remains)%cooldown)|cooldown.convoke_the_spirits.up|!covenant.night_fae)
actions.dreamcatcher+=/force_of_nature
actions.dreamcatcher+=/kindred_spirits,if=buff.timeworn_dreamcatcher.remains>gcd.max&(floor((fight_remains-10)%cooldown)>floor((fight_remains-10-cooldown.ca_inc.remains)%cooldown)&((eclipse.in_solar&spell_targets.starfire=1|eclipse.in_lunar&spell_targets.starfire>1)|(eclipse.solar_next&spell_targets.starfire=1|eclipse.lunar_next&spell_targets.starfire>1))&(!variable.is_aoe|buff.starfall.up)|buff.ca_inc.remains>10|buff.primordial_arcanic_pulsar.value>=370&astral_power>50)
actions.dreamcatcher+=/variable,name=convoke_condition,value=buff.primordial_arcanic_pulsar.value<340&(floor((fight_remains-7)%120)>floor((fight_remains-7-cooldown.ca_inc.remains)%120)|eclipse.state=3&(spell_targets.starfire<3|buff.eclipse_lunar.up&spell_targets.starfire>2)|buff.ca_inc.remains>7)
actions.dreamcatcher+=/convoke_the_spirits,if=variable.convoke_condition&astral_power<=40&buff.timeworn_dreamcatcher.remains>execute_time
actions.dreamcatcher+=/fury_of_elune,if=eclipse.state=3&ap_check&variable.save_to_use_spell&(dot.adaptive_swarm_damage.ticking|!covenant.necrolord|spell_targets>2)
actions.dreamcatcher+=/adaptive_swarm,if=
actions.dreamcatcher+=/starsurge,if=covenant.night_fae&variable.convoke_condition&astral_power>40&cooldown.convoke_the_spirits.up&(!variable.is_aoe|buff.starfall.up)
actions.dreamcatcher+=/starfall,if=covenant.night_fae&variable.convoke_condition&astral_power>40&cooldown.convoke_the_spirits.up&variable.is_aoe&!buff.starfall.up
actions.dreamcatcher+=/new_moon,if=(buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3)&ap_check
actions.dreamcatcher+=/half_moon,if=(buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3)&ap_check&(buff.timeworn_dreamcatcher.remains>execute_time|!buff.timeworn_dreamcatcher.up)
actions.dreamcatcher+=/full_moon,if=(buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3)&ap_check&(buff.timeworn_dreamcatcher.remains>execute_time|!buff.timeworn_dreamcatcher.up)
actions.dreamcatcher+=/warrior_of_elune
actions.dreamcatcher+=/starfire,if=spell_haste<0.4&buff.eclipse_lunar.up|buff.warrior_of_elune.up
actions.dreamcatcher+=/wrath,if=buff.eclipse_solar.up&(!buff.eclipse_lunar.up|spell_targets.starfire=1)&spell_targets<=3&(buff.ca_inc.remains>execute_time|!buff.ca_inc.up)
actions.dreamcatcher+=/starfire,if=buff.eclipse_lunar.up|eclipse.state=1|eclipse.state=0&spell_targets=1|buff.eclipse_solar.up&spell_targets>3|buff.ca_inc.remains>action.wrath.execute_time&spell_targets=1
actions.dreamcatcher+=/wrath
