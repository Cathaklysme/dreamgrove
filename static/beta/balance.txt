actions.precombat=moonkin_form
actions.precombat+=/variable,name=dadspec,value=0

actions=moonfire,target_if=refreshable,if=cooldown.ca_inc.ready|eclipse.state=2&spell_targets.starfire<5|(talent.twin_moons.enabled&spell_targets.starfire<10)
actions+=/sunfire,target_if=refreshable
actions+=/stellar_flare,target_if=refreshable&spell_targets.starfire<3
actions+=/celestial_alignment
actions+=/fury_of_elune
actions+=/force_of_nature
actions+=/convoke_the_spirits,if=astral_power<30
actions+=/kindred_spirits
actions+=/ravenous_frenzy
actions+=/adaptive_swarm
actions+=/starfall,if=!buff.starfall.up&(spell_targets>1|variable.dadspec)
actions+=/starsurge,if=!variable.dadspec&spell_targets.starfall=1&(buff.eclipse_solar.up&spell_targets.starfire=1|buff.eclipse_lunar.up&spell_targets.starfire>1)|astral_power>90|(covenant.night_fae&cooldown.convoke_the_spirits.up)
actions+=/starsurge,if=variable.dadspec&!buff.starfall.up&(buff.eclipse_solar.up&spell_targets.starfire=1|buff.eclipse_lunar.up&spell_targets.starfire>1)
actions+=/new_moon,if=buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3
actions+=/half_moon,if=buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3
actions+=/full_moon,if=buff.eclipse_lunar.up|(charges=2&recharge_time<5)|charges=3
actions+=/wrath,if=buff.eclipse_solar.up&(!buff.eclipse_lunar.up|spell_targets.starfire=1)&spell_targets<=3&(buff.ca_inc.remains>execute_time|!buff.ca_inc.up)
actions+=/warrior_of_elune
actions+=/starfire,if=buff.eclipse_lunar.up|eclipse.state=1|eclipse.state=0&spell_targets=1|buff.eclipse_solar.up&spell_targets>3|buff.ca_inc.remains>action.wrath.execute_time&spell_targets=1
actions+=/wrath
